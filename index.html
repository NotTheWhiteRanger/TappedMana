<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TappedMana | Commander Hub</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mana-font@latest/css/mana.min.css" />
    <style>
      /* (Your existing CSS remains unchanged) */
      body { margin: 0; font-family: 'Roboto', sans-serif; background: linear-gradient(to bottom right, #ffffff, #dbeafe); color: #1e293b; }
      header { background-color: #1e40af; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
      .title { display: flex; align-items: center; gap: 0.5rem; }
      header h1 { margin: 0; font-size: 1.8rem; color: #ffffff; }
      .ms { font-size: 1.4rem; vertical-align: middle; }
      .ms-u { color: #60a5fa; }
      .ms-w { color: #facc15; }
      .ms-c { color: #9ca3af; }
      .ms-b { color: #6b7280; }
      .ms-r { color: #f87171; }
      .ms-g { color: #34d399; }
      .searchbar { flex: 1; text-align: center; position: relative; }
      .searchbar input[type="text"] { width: 60%; padding: 0.5rem; border: none; border-radius: 0.5rem; }
      .searchbar button { padding: 0.5rem 1rem; margin-left: 0.5rem; border: none; border-radius: 0.5rem; background-color: #2563eb; color: #fff; cursor: pointer; }
      .dropdown { position: absolute; top: 100%; left: 15%; width: 62%; background: #fff; border: 1px solid #ccc; border-top: none; max-height: 300px; overflow-y: auto; z-index: 1000; }
      .dropdown-item { padding: 0.5rem; border-bottom: 1px solid #eee; cursor: pointer; display: flex; align-items: center; }
      .dropdown-item:hover { background-color: #f3f4f6; }
      .dropdown-item img { width: 40px; height: auto; margin-right: 0.5rem; }
      .card-info { line-height: 1.2; }
      nav a { margin-left: 1.5rem; text-decoration: none; color: #e0f2fe; font-weight: bold; transition: color 0.3s; }
      nav a:hover { color: #3b82f6; }
      .hero { text-align: center; padding: 4rem 1rem 2rem; }
      .hero h2 { font-size: 2.5rem; margin-bottom: 1rem; color: #1e3a8a; }
      .hero p { font-size: 1.2rem; max-width: 600px; margin: 0 auto; color: #334155; }
      .features { display: flex; flex-wrap: wrap; justify-content: center; padding: 2rem; gap: 2rem; }
      .card { background-color: #ffffff; border-radius: 1rem; padding: 1.5rem; max-width: 300px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: transform 0.3s; }
      .card:hover { transform: scale(1.05); }
      .card h3 { margin-top: 0; color: #1e3a8a; }
      .card p { color: #475569; }
      .top-decks { background: #f1f5f9; padding: 3rem 1rem; text-align: center; }
      .top-decks h2 { font-size: 2rem; margin-bottom: 2rem; color: #1e3a8a; }
      .deck-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 2rem; }
      .deck-card { background: #fff; border-radius: 1rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); overflow: hidden; width: 240px; text-align: center; }
      .deck-card img { width: 100%; display: block; }
      .deck-card .info { padding: 1rem; }
      .deck-card .info h3 { margin: 0 0 0.5rem; color: #1e3a8a; font-size: 1.1rem; }
      .deck-card .info p { font-size: 0.9rem; color: #475569; }
      footer { text-align: center; padding: 2rem 1rem; color: #64748b; font-size: 0.9rem; }
      a.card-link { text-decoration: none; color: inherit; }
    </style>
  </head>
  <body>
    <header>
      <div class="title">
        <h1>TappedMana</h1>
        <span class="ms ms-u"></span>
        <span class="ms ms-w"></span>
        <span class="ms ms-c"></span>
        <span class="ms ms-b"></span>
        <span class="ms ms-r"></span>
        <span class="ms ms-g"></span>
      </div>
      
      <form id="card-search-form" class="searchbar" action="#" onsubmit="return false;">
        <input id="card-search-input" type="text" name="q" placeholder="Search cards..." autocomplete="off" />
        <button type="submit">Search</button>
        <div id="search-dropdown" class="dropdown"></div>
      </form>
      
      <nav>
        <a href="#">Home</a>
        <a href="#">Deck Builder</a>
        <a href="#">Commander Resources</a>
        <a href="#">Login</a>
      </nav>
    </header>

    <section class="hero">
      <h2>Welcome to the Commander Hub</h2>
      <p>Your all-in-one platform for building, managing, and battling in the Magic: The Gathering Commander format.</p>
    </section>

    <section class="features">
      <a href="decks.html" class="card-link">
        <div class="card">
          <h3>Deck Builder</h3>
          <p>Create, edit, and share your Commander decks with intuitive tools and Scryfall integration.</p>
        </div>
      </a>
      <div class="card" style="cursor: pointer;" onclick="window.location.href='https://tappedmana.com/letsplay.html';">
        <h3>Play Online</h3>
        <p>Join live multiplayer games, track turns, and manage your life total with our online table.</p>
      </div>
      <div class="card">
        <h3>Commander Resources</h3>
        <p>Access ban lists, strategy guides, and featured decks curated for Commander players.</p>
      </div>
    </section>

    <section class="top-decks">
      <h2>Top Commander Decks</h2>
      <div class="deck-grid">
        <div class="deck-card">
          <img src="https://cards.scryfall.io/normal/front/5/f/5f4b5d9f-f8f0-42bb-8e6c-f59eb716420f.jpg" alt="Atraxa, Praetors' Voice" />
          <div class="info">
            <h3>Atraxa Superfriends</h3>
            <p>Control, proliferate, and dominate the board with Planeswalkers.</p>
          </div>
        </div>
        <div class="deck-card">
          <img src="https://cards.scryfall.io/normal/front/d/2/d24ff43e-fdc7-4dc8-a917-0b84921c8f41.jpg" alt="Edgar Markov" />
          <div class="info">
            <h3>Vampire Aggro</h3>
            <p>Fast-paced tribal strategy using Edgar's vampire swarm.</p>
          </div>
        </div>
        <div class="deck-card">
          <img src="https://cards.scryfall.io/normal/front/4/8/487d9c6a-2b8b-4d96-a6f0-2a61c77ef7d2.jpg" alt="Tatyova, Benthic Druid" />
          <div class="info">
            <h3>Lands Matter</h3>
            <p>Ramp hard, draw cards, and take over with value engines.</p>
          </div>
        </div>
      </div>
    </section>

    <footer>
      &copy; 2025 TappedMana. Not affiliated with Wizards of the Coast.
    </footer>

    <!-- Firebase auth handling -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
      import { getAuth, onAuthStateChanged, signOut, browserLocalPersistence, setPersistence } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

      // Unified Firebase config (matching the login page)
      const firebaseConfig = {
        apiKey: "AIzaSyD2B6KZgtYQPE4K-JF5GQszp5wjNgX6_MY",
        authDomain: "new-chat-8d4f4.firebaseapp.com",
        projectId: "new-chat-8d4f4",
        storageBucket: "new-chat-8d4f4.appspot.com",
        messagingSenderId: "998012770880",
        appId: "1:998012770880:web:0b9cf74d0a92836b65a6d4",
        databaseURL: "https://new-chat-8d4f4-default-rtdb.firebaseio.com"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      setPersistence(auth, browserLocalPersistence).catch(console.error);

      const nav = document.querySelector("nav");
      if (nav) {
        const links = nav.querySelectorAll("a");
        const loginLogoutLink = links[links.length - 1];

        onAuthStateChanged(auth, (user) => {
          if (user) {
            const welcome = document.createElement("span");
            welcome.textContent = `Welcome, ${user.email}`;
            welcome.style.color = "#e0f2fe";
            welcome.style.marginRight = "1rem";
            nav.insertBefore(welcome, nav.firstChild);

            loginLogoutLink.textContent = "Logout";
            loginLogoutLink.addEventListener("click", (e) => {
              e.preventDefault();
              signOut(auth).then(() => location.reload());
            });
          } else {
            loginLogoutLink.textContent = "Login";
            loginLogoutLink.setAttribute("href", "/login");
          }
        });
      }
    </script>

    <!-- Scryfall Card Search Dropdown Integration with Debounce -->
    <script>
      const input = document.getElementById('card-search-input');
      const dropdown = document.getElementById('search-dropdown');
      let debounceTimer = null;

      input.addEventListener('input', () => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(async () => {
          const query = input.value.trim();
          if (!query) {
            dropdown.innerHTML = '';
            return;
          }

          try {
            const res = await fetch(`https://api.scryfall.com/cards/search?q=${encodeURIComponent(query)}&limit=10`);
            const data = await res.json();
            if (data.object === 'error') throw new Error(data.details);

            dropdown.innerHTML = '';
            if (data.data.length) {
              data.data.forEach(card => {
                const item = document.createElement('div');
                item.className = 'dropdown-item';

                // Determine image URL
                let imageUrl = card.image_uris?.small || card.card_faces?.[0]?.image_uris?.small || '';

                // Truncate oracle text
                const oracleSnippet = card.oracle_text ? card.oracle_text.slice(0, 60) + (card.oracle_text.length > 60 ? 'â€¦' : '') : '';

                item.innerHTML = `
                  ${imageUrl ? `<img src="${imageUrl}" alt="${card.name}" />` : ''}
                  <div class="card-info">
                    <strong>${card.name}</strong><br/>
                    <span class="mana-cost">${card.mana_cost || ''}</span><br/>
                    <small>${oracleSnippet}</small>
                  </div>
                `;

                // On click, fill input and clear dropdown
                item.addEventListener('click', () => {
                  input.value = card.name;
                  dropdown.innerHTML = '';
                });

                dropdown.appendChild(item);
              });
            } else {
              dropdown.innerHTML = '<div class="dropdown-item">No cards found.</div>';
            }
          } catch (err) {
            console.error('Scryfall error:', err);
            dropdown.innerHTML = `<div class="dropdown-item error">Error: ${err.message}</div>`;
          }
        }, 300);
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!document.getElementById('card-search-form').contains(e.target)) {
          dropdown.innerHTML = '';
        }
      });
    </script>
  </body>
</html>

